---
version: 0.1
describe: get_pet_all {per_page?} {page?}

specs:
  - it: get_with_page
    default: true
    expect: pass
    with: ~

  - it: get_with_page_from_arg
    expect: pass
    with:
      per_page: 
      page: 

  - it: get_with_page_as_string
    expect: pass
    with:
      per_page: 100
      page: "invalid str"

  - it: get_with_per_page_as_string
    expect: pass
    with:
      per_page: "invalid str"
      page: 100

do: [
  # model
  model_pet: {$alias: [specs.get_pet_by_id.model_pet]},
  model_pets: {
    $inject: [global.models.collect],
    data.*: "required|of_type:model_pet",
  },

  page: 0,
  per_page: :global.page_size.regular,
  url: {$string.format: [format: '{%s}/pets?page={%d}&per_page={%d}', params: [:global.server, :page, :per_page]]},

  # call api
  response: {$http.get: [:url]},

  # parse
  pets: {$parse.jsonOf: [data: :response.body, model: :model_pets]},
  
  # expose variables
  $return: [pets: :pets, response: :response],
]