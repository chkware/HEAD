---
version: 0.1
describe: get_pet_all {per_page?} {page?}

specs:
  - it: get_with_page
    default: true
    expect: pass
    with: ~

  - it: get_with_page_from_arg
    expect: pass
    with:
      per_page: 
      page: 

  - it: get_with_page_as_string
    expect: pass
    with:
      per_page: 100
      page: "invalid str"

  - it: get_with_per_page_as_string
    expect: pass
    with:
      per_page: "invalid str"
      page: 100

do: [
  $var: {
    page: 0,
    per_page: :global.page_size.regular,
    server: :global.server,
    url: '{%server}/pets?page={%page}&per_page={%per_page}',
    response: ~,
    pet_str: ~,
    pets: ~,
    
    # model
    model_pet: { $alias: specs.get_pet_by_id.model_pet },
    model_pets: {
      { $alias: global.models.collect },
      data.*: "required|of_type:model_pet",
    }
  },

  $set: {
    response: {$http.get: {url: :url}}
  },

  $set: {
    pet_str: :response.body,
  },

  $set: {
    pets: {$parse.json: {data: :pet_str, model: :model_pets}}
  },

  $expose: {
    pets: :pets,
    response: :response,
  }
]