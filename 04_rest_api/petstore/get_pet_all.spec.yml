---
version: 0.1
describe: get_pet_all {per_page?} {page?}

specs:
  - it: get_with_page
    default: true
    expect: pass
    with: ~

  - it: get_with_page_from_arg
    expect: pass
    with:
      per_page: 100
      page: 200

  - it: get_with_page_as_string
    expect: pass
    with:
      per_page: 100
      page: "invalid str"

  - it: get_with_per_page_as_string
    expect: pass
    with:
      per_page: "invalid str"
      page: 100

vars:
  page: 0
  per_page: ${global.page_size.regular}
  server: ${global.server}
  url: ${global.server}/pets?page=${page}&per_page=${per_page}
  
  # model
  model_pet: 
    _reference_: ${specs.get_pet_by_id.model_pet}
  model_pets:
    _reference_: ${global.models.collect}
    data.*: "required|of_type:model_pet"

do: |
  # make request

  var(response, http.GET(url))
  var(pet_str, response.body)

  # parse json

  var(pets, parse.json(pet_str, model_pets))

  # expose pets to callee

  expose(pets)
  expose(response)




