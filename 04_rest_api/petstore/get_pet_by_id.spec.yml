---
version: 0.1
describe: get_pet_by_id {pet_id?}

specs:
  - it: get_with_number
    default: true
    with: 
      pet_id: 1,
    expect: pass
  
  - it: get_with_string
    expect: fail
    with:
      id: 'Faisal weds U'
  
  - it: get_without_id
    expect: fail
    without: [id]
  
  - it: get_with_float
    expect: fail
    with:
      id: 3.5

do: [
  # model
  model_pet: {
    "id": "integer",
    "name": "required|string",
    "breed": "required|string|in:cat,dog",
  },

  pet_id: ~,

  # prepare url
  url: {$string.format: [format: '{%s}/pet/{%d}', params: [:global.server, :pet_id]]},

  # call api
  response: {$http.get: [url: :url]},

  # get response 
  pet_str: :response.body,

  # parse
  pet: {$parse.jsonOf: [data: :pet_str, model: :model_pet]},

  # expose variables
  $return: [pet: :pet, response: :response]
]

# do:
#   - operation: set
#     params:
#       - response
#       - petObj

#   - operation: fetch
#     params: {
#       method: GET,
#       url: http://hasan.net/api1,
#       response*: response,
#     }
#     expect:
#       code: 200

#   - operation: parse
#     params: {
#       type: json,
#       model: models.pet,
#       data: response,
#       validate: true,
#       return*: petObj,
#     }

#   - operation: expose
#     params:
#      - petObj