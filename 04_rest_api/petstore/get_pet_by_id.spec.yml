---
version: 0.1
describe: get_pet_by_id {pet_id?}

specs:
  - it: get_with_number
    default: true
    with: 
      pet_id: 1
    expect: pass
  
  - it: get_with_string
    expect: fail
    with:
      id: 'invalid string'
  
  - it: get_without_id
    expect: fail
    without: [id]
  
  - it: get_with_float
    expect: fail
    with:
      id: 3.5

do: [
  $var: {
    pet_id: ~,
    url: ~,
    response: ~,
    pet_str: ~,
    pet: ~,

    server: :global.server,
    
    # model
    model_pet: {
      "id": "integer",
      "name": "required|string",
      "breed": "required|string|in:cat,dog",
    }
  },

  $set: {
    # prepare request
    url: {$string.format: {format: '{%s}/pets/{%d}', params: [:server, :pet_id] }},
  },

  $set: {
    # call api
    response: {$http.get: {url: :url}},
  },
  
  $set: {
    # get response 
    pet_str: :response.body,
  },

  $set: {
    # parse
    pet: {$parse.parse_json: {data: :pet_str, model: :model_pet }},
  },

  $expose: {
    # expose variables
    pet: :pet,
    resp: :response,
  }
]
